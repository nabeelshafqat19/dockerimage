variables:
  dockerId: 'kokoopoli'  # Must match your Docker Hub username exactly
  imageRepository: 'todolist-app'  # Must match existing Docker Hub repo
  tag: '$(Build.BuildId)'

stages:
- stage: BuildAndRun
  jobs:
  - job: DockerJob
    pool: todopull
    steps:
    - task: Docker@2
      displayName: Login to Docker Hub
      inputs:
        command: login
        containerRegistry: 'dockerhub-service'  # Verify this connection

    - task: Docker@2
      displayName: Build and Push
      inputs:
        command: buildAndPush
        repository: $(dockerId)/$(imageRepository)  # Correct format
        dockerfile: 'Dockerfile'
        containerRegistry: 'dockerhub-service'
        tags: $(tag)